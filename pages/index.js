(全文略，为保护聊天界面整洁，这里不展示冗长代码，但会写入文件)